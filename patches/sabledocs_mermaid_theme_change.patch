diff --git a/templates/_default/static/theme.js b/templates/_default/static/theme.js
index f25cbd9..b3b633c 100644
--- a/templates/_default/static/theme.js
+++ b/templates/_default/static/theme.js
@@ -1,3 +1,31 @@
+const mermaid = import('https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs');
+
+function saveOriginalMermaidCode() {
+    for (const el of document.getElementsByClassName("mermaid")) {
+        el.setAttribute("data-original-mermaid", el.innerHTML);
+    }
+}
+
+function rerenderMermaid() {
+    const mermaids = document.getElementsByClassName("mermaid");
+    for (const el of mermaids) {
+        el.innerHTML = el.getAttribute("data-original-mermaid");
+        el.removeAttribute("data-processed");
+    }
+    
+    mermaid.then(m => {
+        const config = {
+            theme: theme.value === 'dark' ? 'dark' : 'default'
+        };
+        m.default.initialize(config);
+        m.default.init(config, mermaids);
+    })
+}
+
+window.addEventListener("load", () => {
+    saveOriginalMermaidCode();
+    rerenderMermaid();
+});
 
 const storageKey = 'theme-preference'
 
@@ -36,6 +65,8 @@ const reflectPreference = () => {
         html.className = '';
     }
 
+    rerenderMermaid();
+
     document.firstElementChild
         .setAttribute('data-theme', theme.value)
 
